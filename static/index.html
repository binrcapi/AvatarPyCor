<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AvatarPyCor - å¤´åƒç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .github-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .github-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .github-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #starCount {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 4px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .controls-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        input,
        select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .avatar-section {
            padding: 30px;
        }

        .avatar-styles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .avatar-style {
            text-align: center;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .avatar-style:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .avatar-style h3 {
            margin-bottom: 15px;
            color: #495057;
            font-size: 1.1rem;
        }

        .avatar-container {
            display: inline-block;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .avatar-square {
            border-radius: 8px;
        }

        .avatar-rounded {
            border-radius: 20px;
        }

        .avatar-circle {
            border-radius: 50%;
        }

        .avatar-small {
            width: 80px !important;
            height: 80px !important;
        }

        .avatar-medium {
            width: 120px !important;
            height: 120px !important;
        }

        .avatar-large {
            width: 200px !important;
            height: 200px !important;
        }

        .loading {
            display: none;
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            border-left: 4px solid #dc3545;
        }

        .success {
            color: #155724;
            background-color: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            border-left: 4px solid #28a745;
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .buttons {
                flex-direction: column;
            }

            .avatar-styles {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ğŸ¨ AvatarPyCor</h1>
        <p>Pythonå®ç°çš„æ™ºèƒ½å¤´åƒç”Ÿæˆå™¨</p>
        <div class="github-buttons">
            <a href="https://github.com/binrclab/AvatarPyCor" target="_blank" class="github-btn">
                <i class="fab fa-github"></i>
                GitHub
            </a>
            <a href="https://github.com/binrclab/AvatarPyCor/stargazers" target="_blank" class="github-btn">
                <i class="fas fa-star"></i>
                Star <span id="starCount">0</span>
            </a>
            <a href="https://github.com/binrclab/AvatarPyCor#apiä½¿ç”¨" target="_blank" class="github-btn">
                <i class="fas fa-book"></i>
                APIæ–‡æ¡£
            </a>
        </div>
    </div>

    <div class="container">
        <div class="controls-section">
            <div class="controls">
                <div class="control-group">
                    <label for="size">å°ºå¯¸:</label>
                    <input type="number" id="size" value="200" min="100" max="500">
                </div>

                <div class="control-group">
                    <label for="gender">æ€§åˆ«:</label>
                    <select id="gender">
                        <option value="0">éšæœº</option>
                        <option value="1">ç”·æ€§</option>
                        <option value="2">å¥³æ€§</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="amount">æ‰¹é‡æ•°é‡:</label>
                    <input type="number" id="amount" value="5" min="1" max="10">
                </div>

                <div class="control-group">
                    <label for="format">æ ¼å¼:</label>
                    <select id="format">
                        <option value="svg">SVG</option>
                        <option value="png">PNG</option>
                    </select>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-primary" onclick="generateAvatar()">
                    <i class="fas fa-magic"></i>
                    ç”Ÿæˆå•ä¸ªå¤´åƒ
                </button>
                <button class="btn-secondary" onclick="generateBatch()">
                    <i class="fas fa-layer-group"></i>
                    æ‰¹é‡ç”Ÿæˆ
                </button>
                <button class="btn-success" onclick="downloadCurrent()">
                    <i class="fas fa-download"></i>
                    ä¸‹è½½å½“å‰å¤´åƒ
                </button>
                <button class="btn-info" onclick="generateAllStyles()">
                    <i class="fas fa-palette"></i>
                    ç”Ÿæˆæ‰€æœ‰æ ·å¼
                </button>
            </div>
        </div>

        <div class="avatar-section">
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i>
                æ­£åœ¨ç”Ÿæˆå¤´åƒ...
            </div>
            <div class="error" id="error"></div>
            <div class="success" id="success"></div>

            <div class="avatar-styles" id="avatarStyles">
                <div class="avatar-style">
                    <h3>æ­£æ–¹å½¢æ ·å¼</h3>
                    <div class="avatar-container avatar-square" id="squareAvatar">
                        <div
                            style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                            <i class="fas fa-user" style="font-size: 3rem; color: #ccc;"></i>
                        </div>
                    </div>
                </div>

                <div class="avatar-style">
                    <h3>åœ†è§’æ ·å¼</h3>
                    <div class="avatar-container avatar-rounded" id="roundedAvatar">
                        <div
                            style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 20px;">
                            <i class="fas fa-user" style="font-size: 3rem; color: #ccc;"></i>
                        </div>
                    </div>
                </div>

                <div class="avatar-style">
                    <h3>åœ†å½¢æ ·å¼</h3>
                    <div class="avatar-container avatar-circle" id="circleAvatar">
                        <div
                            style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                            <i class="fas fa-user" style="font-size: 3rem; color: #ccc;"></i>
                        </div>
                    </div>
                </div>

                <div class="avatar-style">
                    <h3>å°å°ºå¯¸å±•ç¤º</h3>
                    <div class="avatar-container avatar-small" id="smallAvatar">
                        <div
                            style="width: 80px; height: 80px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                            <i class="fas fa-user" style="font-size: 1.5rem; color: #ccc;"></i>
                        </div>
                    </div>
                    <div class="avatar-container avatar-medium" id="mediumAvatar">
                        <div
                            style="width: 120px; height: 120px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin-top: 10px;">
                            <i class="fas fa-user" style="font-size: 2rem; color: #ccc;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>
                <a href="https://github.com/binrclab/AvatarPyCor" target="_blank">AvatarPyCor</a>
            </p>
        </div>
    </div>

    <script>
        let currentAvatarSvg = '';

        async function generateAvatar() {
            const size = document.getElementById('size').value;
            const gender = document.getElementById('gender').value;

            console.log(`ç”Ÿæˆå¤´åƒ - å°ºå¯¸: ${size}, æ€§åˆ«: ${gender}`);

            showLoading();
            hideMessages();

            try {
                const response = await fetch(`/avatar/json?size=${size}&gender=${gender}`);
                const data = await response.json();

                if (data.success) {
                    currentAvatarSvg = data.data.svg;
                    updateAllAvatars(data.data.svg);
                    console.log(`å¤´åƒç”ŸæˆæˆåŠŸ - æ€§åˆ«: ${data.data.gender}`);
                    showSuccess('å¤´åƒç”ŸæˆæˆåŠŸï¼');
                } else {
                    console.error('ç”Ÿæˆå¤±è´¥:', data.error);
                    showError('ç”Ÿæˆå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function generateAllStyles() {
            const size = document.getElementById('size').value;
            const gender = document.getElementById('gender').value;

            showLoading();
            hideMessages();

            try {
                const response = await fetch(`/avatar/json?size=${size}&gender=${gender}`);
                const data = await response.json();

                if (data.success) {
                    currentAvatarSvg = data.data.svg;
                    updateAllAvatars(data.data.svg);
                    showSuccess('æ‰€æœ‰æ ·å¼å¤´åƒç”ŸæˆæˆåŠŸï¼');
                } else {
                    showError('ç”Ÿæˆå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function updateAllAvatars(svgContent) {
            // æ›´æ–°æ­£æ–¹å½¢æ ·å¼
            document.getElementById('squareAvatar').innerHTML = svgContent;

            // æ›´æ–°åœ†è§’æ ·å¼
            const roundedSvg = svgContent.replace(/<svg/, '<svg style="border-radius: 20px;"');
            document.getElementById('roundedAvatar').innerHTML = roundedSvg;

            // æ›´æ–°åœ†å½¢æ ·å¼
            const circleSvg = svgContent.replace(/<svg/, '<svg style="border-radius: 50%;"');
            document.getElementById('circleAvatar').innerHTML = circleSvg;

            // æ›´æ–°å°å°ºå¯¸
            const smallSvg = svgContent.replace(/width="[^"]*"/, 'width="80"').replace(/height="[^"]*"/, 'height="80"');
            document.getElementById('smallAvatar').innerHTML = smallSvg;

            // æ›´æ–°ä¸­å°ºå¯¸
            const mediumSvg = svgContent.replace(/width="[^"]*"/, 'width="120"').replace(/height="[^"]*"/, 'height="120"');
            document.getElementById('mediumAvatar').innerHTML = mediumSvg;
        }

        async function generateBatch() {
            const size = document.getElementById('size').value;
            const gender = document.getElementById('gender').value;
            const amount = document.getElementById('amount').value;
            const format = document.getElementById('format').value;

            showLoading();
            hideMessages();

            try {
                const response = await fetch('/avatar/save/batch', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        size: parseInt(size),
                        gender: gender,
                        amount: parseInt(amount),
                        format: format
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `avatars_${format}.zip`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    showSuccess(`æˆåŠŸç”Ÿæˆ ${amount} ä¸ª${format.toUpperCase()}å¤´åƒå¹¶ä¸‹è½½ï¼`);
                } else {
                    const errorData = await response.json();
                    showError('æ‰¹é‡ç”Ÿæˆå¤±è´¥: ' + (errorData.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function downloadCurrent() {
            if (!currentAvatarSvg) {
                showError('è¯·å…ˆç”Ÿæˆä¸€ä¸ªå¤´åƒ');
                return;
            }

            const blob = new Blob([currentAvatarSvg], { type: 'image/svg+xml' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'avatar.svg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showSuccess('å¤´åƒä¸‹è½½æˆåŠŸï¼');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }

        function showSuccess(message) {
            const success = document.getElementById('success');
            success.textContent = message;
            success.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }

        // è·å–GitHub staræ•°é‡
        async function getGitHubStars() {
            try {
                const response = await fetch('https://api.github.com/repos/binrclab/AvatarPyCor');
                const data = await response.json();
                if (data.stargazers_count !== undefined) {
                    document.getElementById('starCount').textContent = data.stargazers_count;
                }
            } catch (error) {
                console.log('æ— æ³•è·å–GitHub staræ•°é‡:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆä¸€ä¸ªé»˜è®¤å¤´åƒå’Œè·å–staræ•°é‡
        window.onload = function () {
            generateAvatar();
            getGitHubStars();
        };
    </script>
</body>

</html>